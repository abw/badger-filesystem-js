<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Directory.js | Badger Filesystem</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-badger.css"><meta name="description" content="Filesystem utilities"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Badger Filesystem"><meta property="twitter:description" content="Filesystem utilities"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./" style="display: flex; align-items: center;"><img src="./image/brand_logo.svg" style="width:34px;"></a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/abw/badger-filesystem-js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/DirPath.js~DirPath.html">DirPath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Directory.js~Directory.html">Directory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/File.js~File.html">File</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Path.js~Path.html">Path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~DirPath.html">DirPath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Directory.html">Directory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~File.html">File</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/index.js~Path.html">Path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bin">bin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cwd">cwd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dir">dir</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-file">file</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-bin">bin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-cwd">cwd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-dir">dir</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-file">file</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTO">AUTO</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DIRECTORY">DIRECTORY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FILE">FILE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PATH">PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTO">AUTO</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DIRECTORY">DIRECTORY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FILE">FILE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PATH">PATH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://nodejs.org/api/path.html#pathparsepath">path.parse(path)</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="https://nodejs.org/api/path.html#pathparsepath">path.parse(path)</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Directory.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import process from 'node:process';
import path from 'node:path';
import Path from './Path.js'
import { file } from './File.js'
import { fail } from '@abw/badger-utils';
import { rm, mkdir, rmdir, readdir, stat } from 'node:fs/promises'
import { DIRECTORY, FILE } from './Constants.js';

/**
 * The Directory class implements a wrapper around a filesystem
 * directory.
 */
export class Directory extends Path {
  constructor(path, options={}) {
    super(path, options);
    this.state.type = DIRECTORY;
  }

  /**
   * Fetch a new {@link File} object for a file in the directory.
   * @param {string} path - file path
   * @param {Object} [options] - file configuration options
   * @param {String} [options.codec] - codec for encoding/decoding file data
   * @param {String} [options.encoding=utf8] - character encoding
   * @return {Object} the {@link File} object
   */
  file(path, options) {
    this.debug("file(%s, %o)", path, options);
    return file(this.relativePath(path), this.options(options));
  }

  /**
   * Fetch a new {@link Directory} object for a sub-directory in the directory.
   * @param {string} path - directory path
   * @param {Object} [options] - directory configuration options
   * @param {String} [options.codec] - default codec for encoding/decoding files
   * @param {String} [options.encoding=utf8] - default character encoding for files
   * @return {Object} the {@link Directory} object
   */
  directory(path, options) {
    this.debug("directory(%s, %o)", path, options);
    return dir(this.relativePath(path), this.options(options));
  }

  /**
   * An alias for the {@link directory} method for lazy people
   * @return {Object} the {@link Directory} object
   */
  dir(path, options) {
    this.debug("dir(%s, %o)", path, options);
    return this.directory(path, options);
  }

  /**
   * Returns a new {@link Directory} object for the parent directory
   * @param {Object} [options] - directory configuration options
   * @param {String} [options.codec] - default codec for encoding/decoding files
   * @param {String} [options.encoding=utf8] - default character encoding for files
   * @return {Object} a {@link Directory} object for the parent
   */
  parent(options) {
    this.debug("parent()");
    return this.up(1, options);
  }

  /**
   * Returns a new {@link Directory} object for the parent directory up one or more levels.
   * @param {Integer} [n] - how many levels up
   * @param {Object} [options] - directory configuration options
   * @param {String} [options.codec] - default codec for encoding/decoding files
   * @param {String} [options.encoding=utf8] - default character encoding for files
   * @return {Object} a {@link Directory} object for the parent
   */
  up(n=1, options) {
    this.debug(`up(${n})`);
    return this.directory(
      Array(n).fill('..').join('/'),
      options
    );
  }

  /**
   * Returns the names of the files and sub-directories in the directory
   * @return {Promise} fulfills with an array of the file and directory names
   */
  async read() {
    this.debug("read()");
    return await readdir(this.path());
  }

  /**
   * Returns an array of {@link File} and {@link Directory} objects for the
   * contents of the directory.
   * @return {Promise} fulfills with an array of {@link File} and {@link Directory} objects
   */
  async entries() {
    this.debug("entries()");
    const names = await this.read();
    let entries = [ ];

    for (let name of names) {
      const relpath = this.path(name);
      const stats = await stat(relpath);
      if (stats.isFile()) {
        entries.push(this.file(name))
      }
      else if (stats.isDirectory()) {
        entries.push(this.dir(name));
      }
      // ignore anything that isn't a file or directory
    }
    return entries;
  }
  /**
   * Returns an array of {@link File} objects for the files in the directory.
   * @return {Promise} fulfills with an array of {@link File} objects
   */
  async files() {
    const entries = await this.entries();
    return entries.filter( entry =&gt; entry.type() === FILE )
  }
  /**
   * Returns an array of {@link Directory} objects for the directories in the directory.
   * @return {Promise} fulfills with an array of {@link Directory} objects
   */
  async directories() {
    const entries = await this.entries();
    return entries.filter( entry =&gt; entry.type() === DIRECTORY )
  }
  /**
   * An alias for the {@link directories} method.
   * @return {Promise} fulfills with an array of {@link Directory} objects
   */
  async dirs() {
    return this.directories();
  }

  /**
   * Determines if the directory is empty.
   * @return {Promise} fulfills with a boolean value true (empty) or false (not empty).
   */
  async isEmpty() {
    this.debug("isEmpty()");
    const entries = await this.read();
    return entries.length === 0;
  }

  /**
   * Determines if the directory is not empty.
   * @return {Promise} fulfills with a boolean value true (not empty) or false (empty).
   */
  async notEmpty() {
    this.debug("notEmpty()");
    const empty = await this.isEmpty();
    return !empty;
  }

  /**
   * Empty the directory.
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.force] - force removal of files and directories
   * @param {Boolean} [options.recursive] - recursively empty and delete sub-directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async empty(options={}) {
    this.debug("empty(%o)", options);
    if (await this.exists() &amp;&amp; await this.notEmpty()) {
      await rm(this.path(), options);
    }
    return this;
  }

  /**
   * Make the directory.
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.recursive] - create intermediate directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async mkdir(options={}) {
    this.debug("mkdir(%o)", options);
    const exists = await this.exists();
    if (! exists) {
      await mkdir(this.path(), options);
    }
    return this;
  }

  /**
   * Remove the directory.
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.empty] - delete items in directory
   * @param {Boolean} [options.force] - force delete files and directories
   * @param {Boolean} [options.recursive] - recursively delete sub-directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async rmdir(options={}) {
    this.debug("rmdir(%o)", options);
    if (options.empty) {
      await this.empty(options);
    }
    if (await this.exists()) {
      await rmdir(this.path());
    }
    return this;
  }

  /**
   * Create the directory and any intermediate directories.
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.recursive=true] - recursively create intermediate directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async create(options={ recursive: true }) {
    this.debug("create(%o)", options);
    return await this.mkdir(options);
  }

  /**
   * Empty and delete the directory.
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.empty=true] - empty directory of any files and sub-directories
   * @param {Boolean} [options.recursive=true] - recursively delete sub-directories
   * @param {Boolean} [options.force=true] - force deletion of files and sub-directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async destroy(options={ empty: true, recursive: true, force: true }) {
    this.debug("destroy(%o)", options);
    return await this.rmdir(options);
  }

  /**
   * Assert that a directory exists and optionally create it
   * @param {Object} [options] - configuration options
   * @param {Boolean} [options.create] - create the directory and any intermediate directories if it doesn't exist - equivalent to adding `mkdir` and `recursive` options or calling {@link create}
   * @param {Boolean} [options.mkdir] - create the directory, add the `recursive` option to create intermediate directories - equivalent to calling {@link mkdir}
   * @param {Boolean} [options.recursive] - when used with `mkdir`, creates any intermediate directories
   * @return {Promise} fulfills to the {@link Directory} object
   */
  async mustExist(options={}) {
    this.debug("mustExist(%o)", options);
    if (await this.exists()) {
      return this;
    }
    if (options.mkdir) {
      return this.mkdir(options);
    }
    if (options.create) {
      return this.create();
    }
    fail("Directory does not exist: ", this.path());
  }
}

/**
 * Function to create a new {@link Directory} object
 * @param {string} path - directory path
 * @param {Object} [options] - configuration options
 * @param {Boolean} [options.codec] - a codec for encoding/decoding files
 * @return {Object} the {@link Directory} object
 */
export const dir = (path, options) =&gt; {
  return new Directory(path, options);
}

/**
 * Function to create a new {@link Directory} object for the current working directory
 * @param {Object} [options] - configuration options
 * @param {Boolean} [options.codec] - a codec for encoding/decoding files
 * @return {Object} the {@link Directory} object
 */
export const cwd = options =&gt; {
  return dir(process.cwd(), options);
}

/**
 * Function to create a new {@link Directory} object for the directory of a JS source file
 * @param {string} url - module url - from `import.meta.url`
 * @param {Object} [options] - configuration options
 * @param {Boolean} [options.codec] - a codec for encoding/decoding files
 * @return {Object} the {@link Directory} object
 */
export const bin = (url=process.argv[1], options) =&gt; {
  return dir(
    path.dirname(url.replace(/^file:\/\//, '')),
    options
  );
}

export default Directory
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>


</body></html>